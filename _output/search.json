[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Climate Classification Changes",
    "section": "",
    "text": "1 Introduction\nThis project analyzes global climate classification changes by comparing climate data from a recent period (2015–2024) with the WMO Climatological Reference Period (1961–1990).\nThe analysis will be done by applying the Köppen-Trewartha climate classification system to downloaded ERA5 climate data, analyzing and visualizing the climate classification shifts that have already occurred.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "index.html#process",
    "href": "index.html#process",
    "title": "Climate Classification Changes",
    "section": "1.1 Process",
    "text": "1.1 Process\n\nDownload ERA5 Data –\n\n\nDownload and save ERA5 climate reanalysis datasets.\n\n\nAggregate Climate Variables –\n\n\nCompute climate period averages (temperature & precipitation).\n\n\nDerive Classification Determinants –\n\n\nDerive aggregate seasonal/annual statistics required for classification.\n\n\nAssign Köppen-Trewartha Climate Types\n\n\nApply Köppen-Trewartha classification definitions to all grid cells.\n\n\n\nAnalyze Classification Changes\n\n\nIdentify and visualize classification changes between periods.\n\nUse the sidebar to navigate, or read in order using the chapter links below.",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "index.html#modules",
    "href": "index.html#modules",
    "title": "Climate Classification Changes",
    "section": "1.2 Modules",
    "text": "1.2 Modules\n\n01 — Download ERA5 Climate Data\n\n02 — Aggregate Climate Variables\n\n03 — Derive Classification Determinants\n\n04 — Assign Köppen-Trewartha Types\n\n05 — Analyze Classification Changes",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "index.html#renderview",
    "href": "index.html#renderview",
    "title": "Climate Classification Changes",
    "section": "1.3 Render/View",
    "text": "1.3 Render/View\nRender the full book:\nquarto render\nLive preview (auto-reload in the browser):\nquarto preview",
    "crumbs": [
      "<span class='chapter-number'>1</span>  <span class='chapter-title'>Introduction</span>"
    ]
  },
  {
    "objectID": "01_download_data.html",
    "href": "01_download_data.html",
    "title": "2  Download ERA5 Climate Data",
    "section": "",
    "text": "2.1 Periods\nDownload and save ERA5 climate reanalysis datasets using the Climate Data Store CDSAPI: https://cds.climate.copernicus.eu/how-to-api.\nCode\n# Climatological Reference Period\ncrp = \"CRP\"\ncrp_beg = 1961\ncrp_end = 1990\n# Recent Climate Period\nrcp = \"RCP\"\nrcp_beg = 2015\nrcp_end = 2024",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Download ERA5 Climate Data</span>"
    ]
  },
  {
    "objectID": "01_download_data.html#packages",
    "href": "01_download_data.html#packages",
    "title": "2  Download ERA5 Climate Data",
    "section": "2.2 Packages",
    "text": "2.2 Packages\n\n\nCode\nimport cdsapi\nimport os\nfrom pathlib import Path\nfrom datetime import datetime\nimport pandas as pd\nimport time",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Download ERA5 Climate Data</span>"
    ]
  },
  {
    "objectID": "01_download_data.html#directories",
    "href": "01_download_data.html#directories",
    "title": "2  Download ERA5 Climate Data",
    "section": "2.3 Directories",
    "text": "2.3 Directories\n\n\nCode\ndir_wr = \"_data/01_downloaded_data/\"",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Download ERA5 Climate Data</span>"
    ]
  },
  {
    "objectID": "01_download_data.html#functions",
    "href": "01_download_data.html#functions",
    "title": "2  Download ERA5 Climate Data",
    "section": "2.4 Functions",
    "text": "2.4 Functions\nFunction to download ERA5 temperature and precipitation data.\n\n\nCode\ndef fn_download_climate_data(\n    pth: str, \n    var: str,\n    beg: int,\n    end: int,\n    log_df: pd.DataFrame):\n\n    start_time = datetime.now()\n\n    out = Path(pth)\n    yrs = list(range(beg, end+1))\n    mths = list(range(1, 13))\n\n    if var == \"t\":\n        variable_name = \"2m_temperature\"\n    elif var == \"p\":\n        variable_name = \"total_precipitation\"\n\n    c = cdsapi.Client()  # will read ~/.cdsapirc\n\n    c.retrieve(\n        \"reanalysis-era5-single-levels-monthly-means\",\n        {\n            \"product_type\": \"monthly_averaged_reanalysis\",\n            \"variable\": variable_name,\n            \"year\": yrs,\n            \"month\": mths,\n            \"time\": \"00:00\",\n            \"format\": \"netcdf\"\n        },\n        str(out),\n    )\n\n    file_name = os.path.basename(pth)\n    end_time = datetime.now()  \n    elapsed_time = end_time - start_time  \n    total_seconds = int(elapsed_time.total_seconds())\n    mm, ss = divmod(total_seconds, 60)\n    elapsed_str = f\"{mm:02d}:{ss:02d}\"\n\n\n    # Append new row to log file\n    new_row = {\n        \"File Name\": file_name,\n        \"Time (mm:ss)\": elapsed_str\n    }\n    log_df = pd.concat([log_df, pd.DataFrame([new_row])], ignore_index=True)\n\n    return(log_df)\n\n\nFunction to download ERA5 land sea mask.\n\n\nCode\ndef fn_download_land_sea_mask(\n    pth: str,\n    log_df: pd.DataFrame):\n\n    start_time = datetime.now()\n\n    out = Path(pth)\n    c = cdsapi.Client() \n    c.retrieve(\n        \"reanalysis-era5-single-levels\",\n        {\n            \"product_type\": \"reanalysis\",\n            \"variable\": \"land_sea_mask\",\n            \"year\": \"2000\",\n            \"month\": \"01\",\n            \"day\": \"01\",\n            \"time\": \"00:00\",\n            \"area\": \"90/-179.75/-90/180\", # N/W/S/E (global)\n            \"grid\": \"0.25/0.25\", # ERA5 native grid spacing\n            \"format\": \"netcdf\"\n        },\n        str(out),\n    )\n    \n    file_name = os.path.basename(pth)\n    end_time = datetime.now()  \n    elapsed_time = end_time - start_time  \n    total_seconds = int(elapsed_time.total_seconds())\n    mm, ss = divmod(total_seconds, 60)\n    elapsed_str = f\"{mm:02d}:{ss:02d}\"\n\n    # Append new row to log file\n    new_row = {\n        \"File Name\": file_name,\n        \"Time (mm:ss)\": elapsed_str\n    }\n    log_df = pd.concat([log_df, pd.DataFrame([new_row])], ignore_index=True)\n\n    return(log_df)",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Download ERA5 Climate Data</span>"
    ]
  },
  {
    "objectID": "01_download_data.html#main-process",
    "href": "01_download_data.html#main-process",
    "title": "2  Download ERA5 Climate Data",
    "section": "2.5 Main Process",
    "text": "2.5 Main Process\n\n\nCode\nlog_df = pd.DataFrame(columns=[\"File Name\", \"Time (mm:ss)\"])\n\npth = dir_wr + \"crp_downloaded_t.nc\"\nlog_df = fn_download_climate_data(pth, \"t\", crp_beg, crp_end, log_df)\npth = dir_wr + \"crp_downloaded_p.nc\" \nlog_df = fn_download_climate_data(pth, \"p\", crp_beg, crp_end, log_df)\npth = dir_wr + \"rcp_downloaded_t.nc\" \nlog_df = fn_download_climate_data(pth, \"t\", rcp_beg, rcp_end, log_df)\npth = dir_wr + \"rcp_downloaded_p.nc\"\nlog_df = fn_download_climate_data(pth, \"p\", rcp_beg, rcp_end, log_df)\n\npth = dir_wr + \"land_sea_mask.nc\"\nlog_df = fn_download_land_sea_mask(pth, log_df)",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Download ERA5 Climate Data</span>"
    ]
  },
  {
    "objectID": "01_download_data.html#summary",
    "href": "01_download_data.html#summary",
    "title": "2  Download ERA5 Climate Data",
    "section": "2.6 Summary",
    "text": "2.6 Summary\n\n\nCode\ncp_cv_fn_df = pd.DataFrame(columns=[\"Climate Period\", \"Climate Variable\", \"File Name\"])\n\ndef add_record(df, cp, beg, end, cv):\n\n    if cv == \"t\":\n        cv_name = \"Temperature\"\n    else:\n        cv_name = \"Precipitation\"\n\n    new_row = {\n        \"Climate Period\": cp + \"_\"  + str(beg) + \"_\" + str(end),\n        \"Climate Variable\": cv_name,\n        \"File Name\": cp.lower() + \"_downloaded_\" + cv + \".nc\"\n    }\n    df = pd.concat([df, pd.DataFrame([new_row])], ignore_index=True)\n\n    return (df)\n\ncp_cv_fn_df  = add_record(cp_cv_fn_df, crp, crp_beg, crp_end, \"t\")\ncp_cv_fn_df  = add_record(cp_cv_fn_df, crp, crp_beg, crp_end, \"p\")\ncp_cv_fn_df  = add_record(cp_cv_fn_df, rcp, rcp_beg, rcp_end, \"t\")\ncp_cv_fn_df  = add_record(cp_cv_fn_df, rcp, rcp_beg, rcp_end, \"p\")\n\nnew_row = {\n    \"Climate Period\": \"All Periods\",\n    \"Climate Variable\": \"NA\",\n    \"File Name\": \"land_sea_mask.nc\"\n}\ncp_cv_fn_df = pd.concat([cp_cv_fn_df, pd.DataFrame([new_row])], ignore_index=True)\n\n\n\n\nCode\ndef fn_directory_contents_df(dir):\n    data =  []\n    for fname in os.listdir(dir):\n        # skip hidden files (starting with \".\")\n        if fname.startswith(\".\"):\n            continue\n        fpath = os.path.join(dir, fname)\n        if os.path.isfile(fpath):\n            size_mb = os.path.getsize(fpath) / (1024 * 1024)  # bytes → MB\n            mtime = os.path.getmtime(fpath)\n            #mod_date = datetime.fromtimestamp(mtime).strftime(\"%Y-%m-%d\")\n            mod_time = datetime.fromtimestamp(mtime).strftime(\"%Y-%m-%d %H:%M:%S\")\n            data.append({\n                \"File Name\": fname,\n                \"Downloaded At\": mod_time,\n                \"Size (MB)\": round(size_mb, 2)\n            })\n    df = pd.DataFrame(data)\n\n    # Format Size (MB) with two decimals as string\n    df[\"Size (MB)\"] = df[\"Size (MB)\"].map(\"{:.2f}\".format)\n\n    # Sort in order downloaded, then drop the modified time column\n    df = df.sort_values(by=\"Downloaded At\", ascending=True)\n    #df = df.drop(columns=[\"Last Modified Time\"])\n\n    return df\n\ndir_df = fn_directory_contents_df(dir_wr)\n\n\n\n\nCode\nmerged_df = cp_cv_fn_df.merge(dir_df, on=\"File Name\", how=\"left\") \\\n                       .merge(log_df, on=\"File Name\", how=\"left\") \n\n# Reorder so \"Climate Period\" is first\ncols = [\"Climate Period\"] + [c for c in merged_df.columns if c != \"Climate Period\"]\nmerged_df = merged_df[cols]\n\n\n\n\nCode\nsummary_df = (\n    merged_df.style\n        .hide(axis=\"index\")   # removes row labels (index)\n        .set_table_styles([\n            # Climate Period\n            {\"selector\": \".col0, th.col0\",\n            \"props\": [(\"min-width\", \"110px\"), (\"text-align\", \"left\")]},\n\n            # Climate Variable \n            {\"selector\": \".col1, th.col1\",\n            \"props\": [(\"min-width\", \"130px\"), (\"text-align\", \"left\")]},\n\n            # File Name\n            {\"selector\": \".col2, th.col2\",\n            \"props\": [(\"min-width\", \"160px\"), (\"text-align\", \"left\")]},\n\n            # Downloaded \n            {\"selector\": \".col3, th.col3\",\n            \"props\": [(\"min-width\", \"140px\"), (\"text-align\", \"left\")]},\n\n            # Size (MB) \n            {\"selector\": \".col4, th.col4\",\n            \"props\": [(\"min-width\", \"70px\"), (\"text-align\", \"right\")]},\n\n            # Time  (mm:ss)\n            {\"selector\": \".col5, th.col5\",\n            \"props\": [(\"min-width\", \"80px\"), (\"text-align\", \"right\")]}\n        ])\n)\n\nsummary_df\n\n\n\n\n\n\n\nClimate Period\nClimate Variable\nFile Name\nDownloaded At\nSize (MB)\nTime (mm:ss)\n\n\n\n\nCRP_1961_1990\nTemperature\ncrp_downloaded_t.nc\n2025-09-08 17:06:09\n466.99\n00:54\n\n\nCRP_1961_1990\nPrecipitation\ncrp_downloaded_p.nc\n2025-09-08 17:07:04\n469.96\n00:55\n\n\nRCP_2015_2024\nTemperature\nrcp_downloaded_t.nc\n2025-09-08 17:07:41\n155.60\n00:36\n\n\nRCP_2015_2024\nPrecipitation\nrcp_downloaded_p.nc\n2025-09-08 17:08:17\n158.35\n00:36\n\n\nAll Periods\nNA\nland_sea_mask.nc\n2025-09-08 17:08:36\n0.74\n00:18",
    "crumbs": [
      "<span class='chapter-number'>2</span>  <span class='chapter-title'>Download ERA5 Climate Data</span>"
    ]
  },
  {
    "objectID": "02_aggregate_data.html",
    "href": "02_aggregate_data.html",
    "title": "3  Aggregate Climate Variables",
    "section": "",
    "text": "3.1 Periods\nAggregate temperature and precipitation data for each climate period by longitude, latitude and month number producing a single value per grid cell and month number. Reshape data from long form to wide form (one row per grid cell with each monthly value in a separate column) to facillite the deriving of classification determinants.\nCode\n# Climatological Reference Period\ncrp = \"crp\"\ncrp_beg = 1961\ncrp_end = 1990\n# Recent Climate Period\nrcp = \"rcp\"\nrcp_beg = 2015\nrcp_end = 2024",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Aggregate Climate Variables</span>"
    ]
  },
  {
    "objectID": "02_aggregate_data.html#packages",
    "href": "02_aggregate_data.html#packages",
    "title": "3  Aggregate Climate Variables",
    "section": "3.2 Packages",
    "text": "3.2 Packages\n\n\nCode\nimport xarray as xr\nimport pandas as pd\nimport numpy as np\nimport os\nfrom pathlib import Path\nfrom datetime import datetime",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Aggregate Climate Variables</span>"
    ]
  },
  {
    "objectID": "02_aggregate_data.html#directories",
    "href": "02_aggregate_data.html#directories",
    "title": "3  Aggregate Climate Variables",
    "section": "3.3 Directories",
    "text": "3.3 Directories\n\n\nCode\ndir_rd = \"data/01_downloaded_data/\"\ndir_wr = \"data/02_aggregated_data/\"",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Aggregate Climate Variables</span>"
    ]
  },
  {
    "objectID": "02_aggregate_data.html#mask",
    "href": "02_aggregate_data.html#mask",
    "title": "3  Aggregate Climate Variables",
    "section": "3.4 Mask",
    "text": "3.4 Mask\n\n\nCode\nfil = \"land_sea_mask.nc\"\npth = Path(dir_rd) / fil\nds = xr.open_dataset(\n    pth,\n    engine=\"h5netcdf\",\n    chunks=\"auto\", \n    decode_cf=True\n)\ndf_lsm = ds[\"lsm\"].to_dataframe().reset_index()\ndf_lsm = df_lsm.rename(columns={\"longitude\": \"lon\", \"latitude\": \"lat\"})\ndf_lsm = df_lsm[[\"lon\",\"lat\",\"lsm\"]]",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Aggregate Climate Variables</span>"
    ]
  },
  {
    "objectID": "02_aggregate_data.html#functions",
    "href": "02_aggregate_data.html#functions",
    "title": "3  Aggregate Climate Variables",
    "section": "3.5 Functions",
    "text": "3.5 Functions\n\n3.5.1 Aggregate Climate\n\n\nCode\ndef fn_aggregate_climate(\n    cp: str,\n    cv: str,\n    vnm: str):\n    fil = cp + \"_downloaded_\" + cv + \".nc\"\n    pth = Path(dir_rd) / fil\n    ds = xr.open_dataset(\n        pth,\n        engine=\"h5netcdf\",\n        chunks=\"auto\", \n        decode_cf=True\n    )\n    ds = ds.drop_vars(\"number\")\n    # extract month number from time variable\n    ds = ds.assign_coords(mth=ds[\"valid_time\"].dt.month)\n    # group by month number\n    grp_vnm_da = ds[vnm].groupby(\"mth\").mean(\"valid_time\", keep_attrs=True)\n    # convert to pandas df\n    df_vnm = grp_vnm_da.to_dataframe().reset_index()\n    # rename lon and lat columns\n    df = df_vnm.rename(columns={\"longitude\": \"lon\", \"latitude\": \"lat\"})\n\n    # convert lon values from 0 to 360  to -180 to 180\n    df[\"lon\"] = np.where(df[\"lon\"] &gt; 180, df[\"lon\"] - 360, df[\"lon\"])\n    # modify variables based on type: t = temperature, p = precipitation\n    if cv == \"t\":\n        # convert temperature from kelvin to celsius\n        df[\"t\"] = df[\"t2m\"] - 273.15\n        # select columns to keep\n        df = df[[\"lon\", \"lat\", \"mth\", \"t\"]]\n    elif cv == \"p\":\n        # since era5 precipitation is stored as a daily average, multiply by days in month\n        ds[\"ndy\"] = ds[\"valid_time\"].dt.days_in_month\n        # climate perdiod average number of days in each month number (12 values)\n        da_ndy = ds[\"ndy\"].groupby(\"mth\").mean(\"valid_time\", keep_attrs=True)\n        # convert to df before merging\n        df_ndy = da_ndy.to_dataframe().reset_index()\n        # merge with precipation df\n        df = df.merge(df_ndy[[\"mth\", \"ndy\"]], on=\"mth\", how=\"left\")\n        # conversion from daily avg in m to monthly avg in mm\n        df[\"p\"] = df[\"tp\"] * df[\"ndy\"] * 1000\n        # select columns to keep\n        df = df[[\"lon\", \"lat\", \"mth\", \"p\"]]\n    # downcast columns to reduce size\n    df = df.astype({\"lon\": \"float32\", \"lat\": \"float32\"})\n    df = df.astype({\"mth\": \"int8\"})\n    return(df)\n\n\n\n\n3.5.2 Pivot to wide form\n\n\nCode\ndef fn_pivot_to_wide_form(\n    df: pd.DataFrame,\n    cp: str,\n    cv: str):\n\n    # Pivot to wide form\n    wide_df = df.pivot(index=[\"lon\", \"lat\"], columns=\"mth\", values=cv)\n    # Ensure columns are in month order 1–12\n    wide_df = wide_df.reindex(columns=range(1, 13))\n    # Rename columns 1..12 to m1..m12\n    wide_df.columns = [f\"m{m}\" for m in wide_df.columns]\n    # Reset index to keep lon and lat as normal columns\n    wide_df = wide_df.reset_index()\n\n    # add land sea mask based on lon and lat\n    wide_df = wide_df.merge(df_lsm, on=[\"lon\", \"lat\"],  how=\"left\")\n\n    return(wide_df)\n\n\n\n\n3.5.3 Calculate Grid Area\n\n\nCode\ndef fn_calculate_grid_area(df: pd.DataFrame) -&gt; pd.DataFrame:\n    df = df.copy()\n\n    earth_radius_km = 6371 # km\n    lat_grid_degrees = 0.25\n    lon_grid_degrees = 0.25\n\n    # convert degrees to radians\n    lat_radians = np.radians(df[\"lat\"])\n    lat_grid_radians = np.radians(lat_grid_degrees)\n    lon_grid_radians = np.radians(lon_grid_degrees)\n\n    # cell area in million km²\n    df = df.assign(\n        area=(earth_radius_km**2 *\n              lon_grid_radians *\n              (np.sin(lat_radians + lat_grid_radians / 2) -\n               np.sin(lat_radians - lat_grid_radians / 2))) / 1e6\n    )\n\n    # reorder columns: lat, lon, area, lsm, then everything else\n    cols = [\"lat\", \"lon\", \"area\", \"lsm\"]\n    other_cols = [c for c in df.columns if c not in cols]\n    df = df[cols + other_cols]\n\n    return df",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Aggregate Climate Variables</span>"
    ]
  },
  {
    "objectID": "02_aggregate_data.html#main-process",
    "href": "02_aggregate_data.html#main-process",
    "title": "3  Aggregate Climate Variables",
    "section": "3.6 Main Process",
    "text": "3.6 Main Process\n\n\nCode\nstart = datetime.now()\n\ndf1 = fn_aggregate_climate(crp, \"t\", \"t2m\")\ndf2 = fn_aggregate_climate(crp, \"p\", \"tp\")\ndf3 = fn_aggregate_climate(rcp, \"t\", \"t2m\")\ndf4 = fn_aggregate_climate(rcp, \"p\", \"tp\")\n\nwide_df1 = fn_pivot_to_wide_form(df1, crp, \"t\")\nwide_df2 = fn_pivot_to_wide_form(df2, crp, \"p\")\nwide_df3 = fn_pivot_to_wide_form(df3, rcp, \"t\")\nwide_df4 = fn_pivot_to_wide_form(df4, rcp, \"p\")\n\narea_df1 = fn_calculate_grid_area(wide_df1)\narea_df2 = fn_calculate_grid_area(wide_df2)\narea_df3 = fn_calculate_grid_area(wide_df3)\narea_df4 = fn_calculate_grid_area(wide_df4)\n\nend = datetime.now()\nprint(\"elapsed time: \" + str(end - start))\n\n\nelapsed time: 0:00:27.853293",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Aggregate Climate Variables</span>"
    ]
  },
  {
    "objectID": "02_aggregate_data.html#save",
    "href": "02_aggregate_data.html#save",
    "title": "3  Aggregate Climate Variables",
    "section": "3.7 Save",
    "text": "3.7 Save\n\n\nCode\nfil = \"crp_aggregated_t.parquet\"\npth = Path(dir_wr) / fil\narea_df1.to_parquet(pth, index=False)\n\nfil = \"crp_aggregated_p.parquet\"\npth = Path(dir_wr) / fil\narea_df2.to_parquet(pth, index=False)\n\nfil = \"rcp_aggregated_t.parquet\"\npth = Path(dir_wr) / fil\narea_df3.to_parquet(pth, index=False)\n\nfil = \"rcp_aggregated_p.parquet\"\npth = Path(dir_wr) / fil\narea_df4.to_parquet(pth, index=False)",
    "crumbs": [
      "<span class='chapter-number'>3</span>  <span class='chapter-title'>Aggregate Climate Variables</span>"
    ]
  },
  {
    "objectID": "03_derive_determinants.html",
    "href": "03_derive_determinants.html",
    "title": "4  Derive Classification Determinants",
    "section": "",
    "text": "4.1 Periods\nThe classification definitions for the Koppen-Trewartha classification are based on this analysis description: https://scispace.com/pdf/climate-classification-revisited-from-koppen-to-trewartha-40ofumhxzu.pdf\nCode\n# Climatological Reference Period\ncrp = \"CRP\"\ncrp_beg = 1961\ncrp_end = 1990\ncrp_lbl &lt;- paste0(crp, \" \", crp_beg, \"-\", crp_end)\n# Recent Climate Period\nrcp = \"RCP\"\nrcp_beg = 2015\nrcp_end = 2024\nrcp_lbl &lt;- paste0(rcp, \" \", rcp_beg, \"-\", rcp_end)",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Derive Classification Determinants</span>"
    ]
  },
  {
    "objectID": "03_derive_determinants.html#packages",
    "href": "03_derive_determinants.html#packages",
    "title": "4  Derive Classification Determinants",
    "section": "4.2 Packages",
    "text": "4.2 Packages\n\n\nCode\nsuppressPackageStartupMessages({\n  library(tidyverse)\n  library(arrow)\n  library(gt)\n})",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Derive Classification Determinants</span>"
    ]
  },
  {
    "objectID": "03_derive_determinants.html#directories",
    "href": "03_derive_determinants.html#directories",
    "title": "4  Derive Classification Determinants",
    "section": "4.3 Directories",
    "text": "4.3 Directories\n\n\nCode\ndir_rd &lt;- \"data/02_aggregated_data/\"\ndir_wr &lt;- \"data/03_transformed_data/\"",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Derive Classification Determinants</span>"
    ]
  },
  {
    "objectID": "03_derive_determinants.html#functions",
    "href": "03_derive_determinants.html#functions",
    "title": "4  Derive Classification Determinants",
    "section": "4.5 Functions",
    "text": "4.5 Functions\n\n4.5.1 Temperature Determinants\n\n\nCode\nfn_t_determinants &lt;- function(df) {\n\n  mcols &lt;- paste0(\"m\", 1:12)\n  df &lt;- df |&gt;\n    mutate(\n        tavg = (m1 + m2 + m3 + m4 + m5 + m6 + m7 + m8 + m9 + m10 + m11 + m12) / 12,\n        tmax = pmax(m1, m2, m3, m4, m5, m6, m7, m8, m9, m10, m11, m12),\n        tmin = pmin(m1, m2, m3, m4, m5, m6, m7, m8, m9, m10, m11, m12),\n        tg10 = rowSums(across(all_of(mcols), ~ .x &gt;= 10))\n    )  \n  df &lt;- df |&gt;\n    select(-m1, -m2, -m3, -m4, -m5, -m6, -m7, -m8, -m9, -m10, -m11, -m12)\n  \n  return(df)\n}\n\n\n\n\n4.5.2 Precipitation Determinants\n\n\nCode\nfn_p_determinants &lt;- function(df) {\n\n  mcols &lt;- paste0(\"m\", 1:12)\n  df &lt;- df |&gt;\n    mutate(\n      ptot = (m1 + m2 + m3 + m4 + m5 + m6 + m7 + m8 + m9 + m10 + m11 + m12),\n      pmin = pmin(m1, m2, m3, m4, m5, m6, m7, m8, m9, m10, m11, m12),\n      pl60 = rowSums(across(all_of(mcols), ~ .x &lt; 60)),\n      wtot = case_when(\n        lat &gt;= 0 ~ (m1 + m2 + m3 + m10 + m11 + m12),\n        lat &lt; 0 ~ (m4 + m5 + m6 + m7 + m8 + m9)\n      ),\n      stot = case_when(\n        lat &gt;= 0 ~ (m4 + m5 + m6 + m7 + m8 + m9),\n        lat &lt; 0 ~  (m1 + m2 + m3 + m10 + m11 + m12)\n      )\n    )     \n  df &lt;- df |&gt;\n    select(-m1, -m2, -m3, -m4, -m5, -m6, -m7, -m8, -m9, -m10, -m11, -m12)\n\n  return(df)\n}\n\n\n\n\n4.5.3 Aridity Threshold\n\n\nCode\nfn_aridity_threshold &lt;- function(df) {\n\n# Aridity threshold formula: R = 2.3T – 0.64Pw + 41 \n\n    # R: mean annual precipitation threshold in cm\n\n    # T: mean annual air temperature in °C\n    # Pw: percentage of annual precipitation in winter (6 low-sun months)\n    # winter: October to March in Northern Hemisphere\n    #         April to September in Southern Hemisphere\n\n  df &lt;- df |&gt;\n    mutate(\n      term1 = (2.3 * tavg),\n      term2 = \n        if_else(ptot != 0, \n          (0.64 * ((wtot / ptot) * 100)), # multiply by 100 to convert to %\n          0),\n      term3 = 41,\n      athr = (term1 - term2 + term3) * 10 # convert result from cm to mm\n\n    )  |&gt;\n    select(-term1, -term2, -term3)\n\n  return(df)\n}\n\n\n\n\n4.5.4 Summarize Means\n\n\nCode\nfn_summarize_results &lt;- function(df) {\n  df_means &lt;- df |&gt; \n    select(-c(1:4)) |&gt; \n    # this format is now recommended for dplyr\n    summarise(across(everything(), \\(x) mean(x, na.rm = TRUE))) |&gt; \n    pivot_longer(everything(),\n               names_to = \"stat_id\",\n               values_to = \"stat_value\")\n  return(df_means)\n}",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Derive Classification Determinants</span>"
    ]
  },
  {
    "objectID": "03_derive_determinants.html#main-process",
    "href": "03_derive_determinants.html#main-process",
    "title": "4  Derive Classification Determinants",
    "section": "4.6 Main Process",
    "text": "4.6 Main Process\n\n\nCode\nt_df &lt;- fn_t_determinants(crp_t_df)\np_df &lt;- fn_p_determinants(crp_p_df)\nd_df &lt;- t_df |&gt;\n  left_join(p_df, by = c(\"lon\", \"lat\", \"area\", \"lsm\"))\ncrp_df &lt;- fn_aridity_threshold(d_df)\npth = paste0(dir_wr, \"crp_determinants.parquet\")\nwrite_parquet(crp_df, pth)\ndf1 &lt;- fn_summarize_results(crp_df)\n\nt_df &lt;- fn_t_determinants(rcp_t_df)\np_df &lt;- fn_p_determinants(rcp_p_df)\nd_df &lt;- t_df |&gt;\n  left_join(p_df, by = c(\"lon\", \"lat\", \"area\", \"lsm\"))\nrcp_df &lt;- fn_aridity_threshold(d_df)\npth = paste0(dir_wr, \"rcp_determinants.parquet\")\nwrite_parquet(rcp_df, pth)\ndf2 &lt;- fn_summarize_results(rcp_df)\n\ndf_joined &lt;- df1 |&gt; \n  full_join(df2, by = \"stat_id\") |&gt; \n  rename(\n    crp_stat = stat_value.x,\n    rcp_stat = stat_value.y\n  ) |&gt; \n  mutate(\n    stat_id = recode(stat_id,\n      \"tavg\" = \"Annual Avg Monthly Temperature\",\n      \"tmax\" = \"Annual Max Monthly Temperature\",\n      \"tmin\" = \"Annual Min Monthly Temperature\",\n      \"tg10\" = \"Annual Months with Temperature &gt; 10°C\",\n      \"ptot\" = \"Annual Total Precipitation\",\n      \"pmin\" = \"Annual Min Monthly Precipitation\",\n      \"pl60\" = \"Annual Months with Precipitation &lt; 60mm\",\n      \"wtot\" = \"Annual Total Winter Precipitation\",\n      \"stot\" = \"Annual Total Summer Precipitation\",\n      \"athr\" = \"Aridity Threshold\"\n    )\n  )",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Derive Classification Determinants</span>"
    ]
  },
  {
    "objectID": "03_derive_determinants.html#summary",
    "href": "03_derive_determinants.html#summary",
    "title": "4  Derive Classification Determinants",
    "section": "4.7 Summary",
    "text": "4.7 Summary\n\n\nCode\ngt_tbl &lt;- \n  df_joined |&gt;\n    gt(rowname_col = \"stat_id\") |&gt;\n    tab_header(\n      title = \"Climate Classification Determinants Summary\"\n    ) |&gt;\n    tab_spanner(\n      label = crp_lbl,\n      columns = c(crp_stat)\n    ) |&gt;\n    tab_spanner(\n      label = rcp_lbl,\n      columns = c(rcp_stat)\n    ) |&gt;\n    cols_label(\n      crp_stat = \"Average Determinant\",\n      rcp_stat = \"Average Determinant\",\n    ) |&gt;\n    fmt_number(\n      columns = c(crp_stat, rcp_stat),\n      decimals = 2\n   )\n\ngt_tbl\n\n\n\n\n\n\n\n\n\n\n\n\n\nClimate Classification Determinants Summary\n\n\n\n\nCRP 1961-1990\n\n\nRCP 2015-2024\n\n\n\nAverage Determinant\nAverage Determinant\n\n\n\n\nAnnual Avg Monthly Temperature\n4.78\n5.91\n\n\nAnnual Max Monthly Temperature\n12.40\n13.23\n\n\nAnnual Min Monthly Temperature\n−1.81\n−0.63\n\n\nAnnual Months with Temperature &gt; 10°C\n5.99\n6.16\n\n\nAnnual Total Precipitation\n860.75\n890.33\n\n\nAnnual Min Monthly Precipitation\n38.23\n37.28\n\n\nAnnual Months with Precipitation &lt; 60mm\n6.35\n6.29\n\n\nAnnual Total Winter Precipitation\n402.97\n419.46\n\n\nAnnual Total Summer Precipitation\n457.78\n470.87\n\n\nAridity Threshold\n215.19\n241.51",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Derive Classification Determinants</span>"
    ]
  },
  {
    "objectID": "04_assign_types.html",
    "href": "04_assign_types.html",
    "title": "5  Assign Classification Types",
    "section": "",
    "text": "5.1 Periods\nUse the classification determinants to calculate the climate type for each grid cell, using the Köppen-Trewartha classification system.\nCode\n# Climatological Reference Period\ncrp = \"crp\"\ncrp_beg &lt;- 1961\ncrp_end &lt;- 1990\ncrp_lbl &lt;- paste(\"CRP \", crp_beg, \"-\", crp_end, sep = \"\")\n# Recent Climate Period\nrcp = \"rcp\"\nrcp_beg &lt;- 2015\nrcp_end &lt;- 2024\nrcp_lbl &lt;- paste(\"RCP \", rcp_beg, \"-\", rcp_end, sep = \"\")",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Assign Classification Types</span>"
    ]
  },
  {
    "objectID": "04_assign_types.html#packages",
    "href": "04_assign_types.html#packages",
    "title": "5  Assign Classification Types",
    "section": "5.2 Packages",
    "text": "5.2 Packages\n\n\nCode\nsuppressPackageStartupMessages({\n  library(tidyverse)\n  library(sf)\n  library(arrow)\n  library(gt)\n  library(units)\n})",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Assign Classification Types</span>"
    ]
  },
  {
    "objectID": "04_assign_types.html#directories",
    "href": "04_assign_types.html#directories",
    "title": "5  Assign Classification Types",
    "section": "5.3 Directories",
    "text": "5.3 Directories\n\n\nCode\ndir_rf &lt;- \"_data/00_reference/\"\ndir_rd &lt;- \"_data/03_transformed_data/\"\ndir_wr &lt;- \"_data/04_classified_data/\"",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Assign Classification Types</span>"
    ]
  },
  {
    "objectID": "04_assign_types.html#palettes",
    "href": "04_assign_types.html#palettes",
    "title": "5  Assign Classification Types",
    "section": "5.4 Palettes",
    "text": "5.4 Palettes\n\n\nCode\npth &lt;- paste0(dir_rf,\"tcc_group_palette.csv\")\ntcc_group_palette &lt;- read_csv(pth, show_col_types = FALSE)\npth &lt;- paste0(dir_rf,\"tcc_type_palette.csv\")\ntcc_type_palette &lt;- read_csv(pth, show_col_types = FALSE)",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Assign Classification Types</span>"
    ]
  },
  {
    "objectID": "04_assign_types.html#projections",
    "href": "04_assign_types.html#projections",
    "title": "5  Assign Classification Types",
    "section": "5.5 Projections",
    "text": "5.5 Projections\n\n\nCode\nrbn_prj &lt;- \"ESRI:54030\"",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Assign Classification Types</span>"
    ]
  },
  {
    "objectID": "04_assign_types.html#coastline",
    "href": "04_assign_types.html#coastline",
    "title": "5  Assign Classification Types",
    "section": "5.6 Coastline",
    "text": "5.6 Coastline\n\n\nCode\ndir &lt;- dir_rf\nfil &lt;- \"global-coastline.gpkg\"\npth &lt;- paste(dir, fil, sep = \"\")\ncoastline_sf &lt;- st_read(pth, quiet=TRUE)",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Assign Classification Types</span>"
    ]
  },
  {
    "objectID": "04_assign_types.html#import",
    "href": "04_assign_types.html#import",
    "title": "5  Assign Classification Types",
    "section": "5.7 Import",
    "text": "5.7 Import\n\n\nCode\npth &lt;- paste(dir_rd, \"crp_determinants.parquet\", sep = \"\")\ncrp_determinants_df &lt;- read_parquet(pth) \npth &lt;- paste(dir_rd, \"rcp_determinants.parquet\", sep = \"\")\nrcp_determinants_df &lt;- read_parquet(pth)",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Assign Classification Types</span>"
    ]
  },
  {
    "objectID": "04_assign_types.html#functions",
    "href": "04_assign_types.html#functions",
    "title": "5  Assign Classification Types",
    "section": "5.8 Functions",
    "text": "5.8 Functions\n\n\nCode\nfn_classify_tcc &lt;- function(df) {\n  df &lt;- df |&gt;\n    mutate(\n      z1 = case_when(\n        tmax &lt; 10 ~ \"F\",\n        ptot &lt; athr ~ \"B\",\n        tmin &gt;= 18 ~ \"A\",\n        tg10 &gt;= 8 ~ \"C\",\n        tg10 &gt;= 4 ~ \"D\",\n        tg10 &gt;= 1 ~ \"E\",\n        TRUE ~ \"X\"\n      ),\n      zn = \"\"\n    )\n\n  df &lt;- df |&gt;\n    mutate(\n      z2 = case_when(\n        z1 == \"A\" & (pl60 &lt;= 2) ~ \"r\",\n        z1 == \"A\" ~ \"w\",\n        z1 == \"B\" & (ptot &lt; athr/2) ~ \"W\",\n        z1 == \"B\" ~ \"S\",\n\n        z1 == \"C\" & (wtot &gt;= stot * 3) & (pmin &lt; 30) & (ptot &lt; 890) ~ \"s\",\n        z1 == \"C\" & (stot &gt;= wtot * 10) ~ \"w\",\n        z1 == \"C\" ~ \"f\",\n\n        z1 == \"D\" & (tmin &gt; 0) ~ \"o\",\n        z1 == \"D\" ~ \"c\",\n        z1 == \"F\" & (tmax &gt; 0) ~ \"t\",\n        z1 == \"F\" ~ \"i\",\n        TRUE ~ \"\"\n      ),\n      zn = paste(z1, z2, sep = \"\")\n    )\n  df &lt;- df|&gt; select(lon, lat, area, lsm, zn)\n  return(df)\n}",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Assign Classification Types</span>"
    ]
  },
  {
    "objectID": "04_assign_types.html#main-process",
    "href": "04_assign_types.html#main-process",
    "title": "5  Assign Classification Types",
    "section": "5.9 Main Process",
    "text": "5.9 Main Process\n\n\nCode\ndf1 &lt;- fn_classify_tcc(crp_determinants_df)\ndf2 &lt;- fn_classify_tcc(rcp_determinants_df)\ntcc_df &lt;- df1 %&gt;% \n  left_join(df2 , by = c(\"lon\", \"lat\", \"lsm\")) |&gt;\n  rename(czn = zn.x, rzn = zn.y, area = area.x) |&gt;\n  select(lon, lat, lsm, area, czn, rzn) |&gt;\n  mutate(czn = factor(czn, levels = tcc_type_palette$typ)) |&gt;\n  mutate(rzn = factor(rzn, levels = tcc_type_palette$typ))\n\ntcc_sf &lt;- st_as_sf(tcc_df, coords = c(\"lon\", \"lat\"), crs = 4326)\n\ntcc_cmb_sf &lt;- tcc_sf |&gt;\n  filter(lsm &gt; 0) |&gt;\n  summarise(\n    geometry = st_combine(geometry),\n    mkm = sum(area*lsm),\n    .by = c(czn, rzn)\n  ) |&gt;\n  mutate(cz1 = substr(czn, 1, 1)) |&gt;\n  mutate(rz1 = substr(rzn, 1, 1)) |&gt;\n  mutate(pct = round(mkm / sum(mkm) * 100, 3)) |&gt;\n  select(czn, cz1, rzn, rz1, mkm, pct, geometry) |&gt;\n  arrange(czn, rzn) \ntcc_cmb_sf &lt;- st_set_crs(tcc_cmb_sf, 4326)",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Assign Classification Types</span>"
    ]
  },
  {
    "objectID": "04_assign_types.html#save",
    "href": "04_assign_types.html#save",
    "title": "5  Assign Classification Types",
    "section": "5.10 Save",
    "text": "5.10 Save\n\n\nCode\nfil &lt;- \"tcc_classifications.gpkg\"\ndir &lt;- dir_wr\npth &lt;- paste0(dir,fil)\nst_write(tcc_cmb_sf, pth, delete_dsn = TRUE, quiet = TRUE)\n\n\n\n\nCode\nfn_create_map &lt;- function(plot_data, palette, cp_lbl) {\n\n  p &lt;- ggplot(plot_data) +\n    geom_sf(aes(color = type), size = 0.01) +\n    scale_color_manual(values = palette, drop = FALSE) +\n    geom_sf(\n      data = coastline_sf,\n      color = \"black\",\n      linewidth = 0.1\n    ) +\n    coord_sf(crs = rbn_prj) +\n    labs(\n      title = \"Köppen-Trewartha Climate Classification\",\n      subtitle = cp_lbl,\n      color = \"Types\"\n    ) +\n    guides(\n      color = guide_legend(\n        override.aes = list(\n          size = 5 # legend point size only\n        )\n      )\n    )\n    return(p)\n}\n\n\n\n\nCode\nfn_build_summary_table &lt;- function(df, cp) {\n  tbl &lt;- df |&gt;\n    gt(rowname_col = \"typ\" ) |&gt;\n    tab_stubhead(label = \"Type\")|&gt;\n    tab_header(\n      title = paste(\"Classification Summary:\",cp)\n    ) |&gt;\n\n    # 2) center body *and* summary cells for Area\n    cols_align(align = \"center\", columns = mkm) |&gt;\n    # 1) center the column header\n    tab_style(\n      style = cell_text(align = \"center\"),\n      locations = cells_column_labels(columns = mkm)\n    ) |&gt;\n\n    cols_label(\n      lbl = \"Description\",\n      mkm = \"Area (Mkm²)\",\n      pct = \"%\"\n    ) |&gt;\n\n    fmt_number(columns = c(mkm), decimals = 1) |&gt;\n    fmt_number(columns = c(pct), decimals = 2) |&gt;\n    grand_summary_rows(\n      columns = c(mkm, pct),\n      fns = list(\"Total\" = ~ sum(.)),\n      fmt = list(~ fmt_number(.x, decimals = 1))\n    ) \n}",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Assign Classification Types</span>"
    ]
  },
  {
    "objectID": "04_assign_types.html#summary",
    "href": "04_assign_types.html#summary",
    "title": "5  Assign Classification Types",
    "section": "5.11 Summary",
    "text": "5.11 Summary\n\n\nCode\ncrp_tbl_df &lt;- tcc_cmb_sf |&gt;\n  st_drop_geometry() |&gt;\n  rename(typ = czn) |&gt;\n  select(typ, mkm, pct) |&gt;\n  summarise(\n    mkm = sum(mkm),\n    pct = sum(pct),\n    .by = typ\n  )|&gt;\n  arrange(typ)\n\ndf1 &lt;- crp_tbl_df\n\ndf2 &lt;- tcc_type_palette |&gt; select(typ, lbl)\n\ndfj &lt;- df1 |&gt;\n   left_join(df2, by = \"typ\") |&gt;\n   select(typ,lbl,mkm,pct)\n\nt1 &lt;- fn_build_summary_table(dfj, crp_lbl)\n\n\n\n\nCode\nrcp_tbl_df &lt;- tcc_cmb_sf |&gt;\n  st_drop_geometry() |&gt;\n  rename(typ = rzn) |&gt;\n  select(typ, mkm, pct) |&gt;\n  summarise(\n    mkm = sum(mkm),\n    pct = sum(pct),\n    .by = typ\n  ) |&gt;\n  arrange(typ)\n\ndf1 &lt;- rcp_tbl_df\n\ndf2 &lt;- tcc_type_palette |&gt; select(typ, lbl)\n\ndfj &lt;- df1 |&gt;\n   left_join(df2, by = \"typ\") |&gt;\n   select(typ,lbl,mkm,pct)\n\nt2 &lt;- fn_build_summary_table(dfj, rcp_lbl)",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Assign Classification Types</span>"
    ]
  },
  {
    "objectID": "04_assign_types.html#map",
    "href": "04_assign_types.html#map",
    "title": "5  Assign Classification Types",
    "section": "5.12 Map",
    "text": "5.12 Map\n\n\nCode\nplot_data &lt;- tcc_cmb_sf |&gt;\n  select(czn) |&gt;\n  rename(type = czn)\n\ntype_levels &lt;- tcc_type_palette$typ\n\ntype_palette &lt;- setNames(\n  tcc_type_palette$hex,\n  tcc_type_palette$typ\n)\n\nplot_data &lt;- plot_data |&gt;\n  mutate(type = factor(type, levels = type_levels))\n\nplot_palette &lt;- type_palette[levels(plot_data$type)]\n\nv1 &lt;- fn_create_map(plot_data,plot_palette,crp_lbl)\n\n\n\n\nCode\nplot_data &lt;- tcc_cmb_sf |&gt;\n  select(rzn) |&gt;\n  rename(type = rzn)\n\ntype_levels &lt;- tcc_type_palette$typ\n\ntype_palette &lt;- setNames(\n  tcc_type_palette$hex,\n  tcc_type_palette$typ\n)\n\nplot_data &lt;- plot_data |&gt;\n  mutate(type = factor(type, levels = type_levels))\n\nplot_palette &lt;- type_palette[levels(plot_data$type)]\n\nv2 &lt;- fn_create_map(plot_data,plot_palette,rcp_lbl)\n\n\n\n\nCode\nt1\n\n\n\n\n\n\n\n\nClassification Summary: CRP 1961-1990\n\n\nType\nDescription\nArea (Mkm²)\n%\n\n\n\n\nAr\nTropical Rainforest\n11.1\n7.59\n\n\nAw\nTropical Savanna (dry season)\n15.4\n10.57\n\n\nBW\nDesert (Arid)\n25.0\n17.12\n\n\nBS\nSteppe (Semiarid)\n14.1\n9.64\n\n\nCs\nMediterranean (dry summer)\n0.7\n0.48\n\n\nCw\nSubtropical (dry winter)\n1.0\n0.70\n\n\nCf\nSubtropical (no dry season)\n12.0\n8.21\n\n\nDo\nTemperate (Oceanic)\n4.2\n2.87\n\n\nDc\nTemperate (Continental)\n18.3\n12.52\n\n\nE\nBoreal (Subarctic)\n20.7\n14.16\n\n\nFt\nTundra\n7.8\n5.34\n\n\nFi\nIce Cap\n15.7\n10.80\n\n\nTotal\n—\n145.8\n100.0\n\n\n\n\n\n\n\n\n\nCode\nv1 \n\n\n\n\n\n\n\n\n\n\n\nCode\nt2\n\n\n\n\n\n\n\n\nClassification Summary: RCP 2015-2024\n\n\nType\nDescription\nArea (Mkm²)\n%\n\n\n\n\nAr\nTropical Rainforest\n9.1\n6.23\n\n\nAw\nTropical Savanna (dry season)\n17.2\n11.82\n\n\nBW\nDesert (Arid)\n27.5\n18.84\n\n\nBS\nSteppe (Semiarid)\n15.4\n10.56\n\n\nCs\nMediterranean (dry summer)\n0.6\n0.42\n\n\nCw\nSubtropical (dry winter)\n0.8\n0.54\n\n\nCf\nSubtropical (no dry season)\n11.6\n7.98\n\n\nDo\nTemperate (Oceanic)\n4.9\n3.34\n\n\nDc\nTemperate (Continental)\n18.9\n12.93\n\n\nE\nBoreal (Subarctic)\n18.6\n12.77\n\n\nFt\nTundra\n5.8\n3.98\n\n\nFi\nIce Cap\n15.5\n10.60\n\n\nTotal\n—\n145.8\n100.0\n\n\n\n\n\n\n\n\n\nCode\nv2",
    "crumbs": [
      "<span class='chapter-number'>5</span>  <span class='chapter-title'>Assign Classification Types</span>"
    ]
  },
  {
    "objectID": "05_analyze_changes.html",
    "href": "05_analyze_changes.html",
    "title": "6  Analyze Classification Changes",
    "section": "",
    "text": "6.1 Periods\nCode\n# Climatological Reference Period\ncrp = \"crp\"\ncrp_beg &lt;- 1961\ncrp_end &lt;- 1990\ncrp_lbl &lt;- paste(\"CRP \", crp_beg, \"-\", crp_end, sep = \"\")\n# Recent Climate Period\nrcp = \"rcp\"\nrcp_beg &lt;- 2011\nrcp_end &lt;- 2024\nrcp_lbl &lt;- paste(\"RCP \", rcp_beg, \"-\", rcp_end, sep = \"\")",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Analyze Classification Changes</span>"
    ]
  },
  {
    "objectID": "05_analyze_changes.html#packages",
    "href": "05_analyze_changes.html#packages",
    "title": "6  Analyze Classification Changes",
    "section": "6.2 Packages",
    "text": "6.2 Packages\n\n\nCode\nsuppressPackageStartupMessages({\n  library(tidyverse)\n  library(sf)\n  library(arrow)\n  library(units)\n  library(gt)\n})",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Analyze Classification Changes</span>"
    ]
  },
  {
    "objectID": "05_analyze_changes.html#directories",
    "href": "05_analyze_changes.html#directories",
    "title": "6  Analyze Classification Changes",
    "section": "6.3 Directories",
    "text": "6.3 Directories\n\n\nCode\ndir_rf &lt;- \"data/00_reference/\"\ndir_rd &lt;- \"data/04_classified_data/\"",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Analyze Classification Changes</span>"
    ]
  },
  {
    "objectID": "05_analyze_changes.html#palettes",
    "href": "05_analyze_changes.html#palettes",
    "title": "6  Analyze Classification Changes",
    "section": "6.4 Palettes",
    "text": "6.4 Palettes\n\n\nCode\npth &lt;- paste0(dir_rf,\"tcc_group_palette.csv\")\ntcc_group_palette &lt;- read_csv(pth, show_col_types = FALSE)\npth &lt;- paste0(dir_rf,\"tcc_type_palette.csv\")\ntcc_type_palette &lt;- read_csv(pth, show_col_types = FALSE)",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Analyze Classification Changes</span>"
    ]
  },
  {
    "objectID": "05_analyze_changes.html#projections",
    "href": "05_analyze_changes.html#projections",
    "title": "6  Analyze Classification Changes",
    "section": "6.5 Projections",
    "text": "6.5 Projections\n\n\nCode\nrbn_prj &lt;- \"ESRI:54030\"",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Analyze Classification Changes</span>"
    ]
  },
  {
    "objectID": "05_analyze_changes.html#coastline",
    "href": "05_analyze_changes.html#coastline",
    "title": "6  Analyze Classification Changes",
    "section": "6.6 Coastline",
    "text": "6.6 Coastline\n\n\nCode\ndir &lt;- dir_rf\nfil &lt;- \"global-coastline.gpkg\"\npth &lt;- paste(dir, fil, sep = \"\")\ncoastline_sf &lt;- st_read(pth, quiet=TRUE)",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Analyze Classification Changes</span>"
    ]
  },
  {
    "objectID": "05_analyze_changes.html#import",
    "href": "05_analyze_changes.html#import",
    "title": "6  Analyze Classification Changes",
    "section": "6.7 Import",
    "text": "6.7 Import\n\n\nCode\npth &lt;- paste(dir_rd, \"kcc_classifications.gpkg\", sep = \"\")\nkcc_zones_sf &lt;- st_read(pth, quiet=TRUE)\n\npth &lt;- paste(dir_rd, \"tcc_classifications.gpkg\", sep = \"\")\ntcc_zones_sf &lt;- st_read(pth, quiet=TRUE)",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Analyze Classification Changes</span>"
    ]
  },
  {
    "objectID": "05_analyze_changes.html#functions",
    "href": "05_analyze_changes.html#functions",
    "title": "6  Analyze Classification Changes",
    "section": "6.8 Functions",
    "text": "6.8 Functions\n\n\nCode\nfn_climate_group_changes &lt;- function(sf) {\n  cz1_sf &lt;- sf |&gt;\n    select(cz1,mkm,pct,geom) |&gt;\n    summarize(\n      mkm = sum(mkm),\n      pct = sum(pct),\n      geom = st_combine(geom),\n      .by = c(cz1)) |&gt;\n      rename(cg = cz1)\n\n  rz1_sf &lt;- sf |&gt;\n    select(rz1,mkm,pct,geom) |&gt;\n    summarize(\n      mkm = sum(mkm),\n      pct = sum(pct),\n      geom = st_combine(geom),\n      .by = c(rz1))|&gt;\n      rename(cg = rz1)\n\n  cz1_df &lt;- cz1_sf |&gt; st_drop_geometry()\n  rz1_df &lt;- rz1_sf |&gt; st_drop_geometry()\n\n  z1x_df &lt;- cz1_df |&gt; \n    inner_join(rz1_df, by = \"cg\") |&gt;\n    mutate(\n      mkm.chg = mkm.y - mkm.x,\n      pct.chg = pct.y - pct.x\n    ) |&gt;\n    select(cg, mkm.x, mkm.y, mkm.chg, pct.x, pct.y, pct.chg)\n\n  return(z1x_df)\n}\n\n\n\n\nCode\nfn_build_summary_table &lt;- function(df, cc_name) {\n  tbl &lt;- df |&gt;\n    gt(rowname_col = \"cg\" ) |&gt;\n    tab_stubhead(label = \"Group\")|&gt;\n    tab_header(\n      title = paste(cc_name,\" Climate Group Changes\"),\n    ) |&gt;\n    tab_spanner(\n      label = \"Area (Mkm²)\",\n      columns = c(mkm.x, mkm.y, mkm.chg)\n    ) |&gt;\n    tab_spanner(\n      label = \"Group % of Total\",\n      columns = c(pct.x, pct.y, pct.chg)\n    ) |&gt;\n    cols_label(\n      cg = \"Climate Group\",\n      mkm.x = \"CRP\",\n      mkm.y = \"RCP\",\n      mkm.chg = \"Chg\",\n      pct.x = \"CRP\",\n      pct.y = \"RCP\",\n      pct.chg = \"Chg\"\n    ) |&gt;\n    fmt_number(columns = c(mkm.x, mkm.y, mkm.chg), decimals = 1) |&gt;\n    fmt_number(columns = c(pct.x, pct.y, pct.chg), decimals = 2) |&gt;\n    grand_summary_rows(\n      columns = c(mkm.x, mkm.y, mkm.chg, pct.x, pct.y, pct.chg),\n      fns = list(\"Total\" = ~ sum(.)),\n      fmt = list(~ fmt_number(.x, decimals = 2))\n    ) |&gt;\n    tab_footnote(\n      footnote = paste(\"Climatological Reference Period \", crp_beg, \"-\", crp_end, sep = \"\"),\n      locations = cells_column_labels(columns = c(mkm.x, pct.x))\n    ) |&gt;\n    tab_footnote(\n      footnote = paste(\"Recent Climate Period \", rcp_beg, \"-\", rcp_end, sep = \"\"),\n      locations = cells_column_labels(columns = c(mkm.y, pct.y))\n    ) |&gt;\n    tab_style(\n      style = cell_fill(color = \"lightblue\"),\n      locations = cells_body(\n        rows = abs(pct.chg) &gt; 1   # condition here\n      )\n    )\n}\n\n\n\n\nCode\nfn_create_map &lt;- function(plot_data, cc_name, palette, labels) {\n\n  p &lt;- ggplot(plot_data) +\n    geom_sf(aes(color = Group), size = 0.01) +\n    scale_color_manual(\n      values = palette,\n      labels = labels,\n      name = \"Climate Group\")+\n    geom_sf(\n      data = coastline_sf,\n      color = \"black\",\n      linewidth = 0.1\n    ) +\n    coord_sf(crs = rbn_prj) +\n    labs(\n      title = paste(cc_name,\" Climate Classification Groups\"),\n      subtitle = crp_lbl,\n      color = \"Groups\"\n    ) +\n    guides(\n      color = guide_legend(\n        override.aes = list(\n          size = 3 # legend point size only\n        )\n      )\n    )\n    return(p)\n}",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Analyze Classification Changes</span>"
    ]
  },
  {
    "objectID": "05_analyze_changes.html#main-process",
    "href": "05_analyze_changes.html#main-process",
    "title": "6  Analyze Classification Changes",
    "section": "6.9 Main Process",
    "text": "6.9 Main Process",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Analyze Classification Changes</span>"
    ]
  },
  {
    "objectID": "05_analyze_changes.html#summary",
    "href": "05_analyze_changes.html#summary",
    "title": "6  Analyze Classification Changes",
    "section": "6.10 Summary",
    "text": "6.10 Summary\n\n\nCode\ntcc_z1_chg_df &lt;- fn_climate_group_changes(tcc_zones_sf)\ntcc_z1_tbl_gt &lt;- fn_build_summary_table(tcc_z1_chg_df, \"Trewartha\")\ntcc_z1_tbl_gt\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nTrewartha Climate Group Changes\n\n\nGroup\n\nArea (Mkm²)\n\n\nGroup % of Total\n\n\n\nCRP1\nRCP2\nChg\nCRP1\nRCP2\nChg\n\n\n\n\nA\n26.5\n26.3\n−0.2\n18.16\n18.04\n−0.12\n\n\nB\n39.0\n42.9\n3.8\n26.77\n29.40\n2.63\n\n\nC\n13.7\n13.0\n−0.6\n9.38\n8.94\n−0.45\n\n\nD\n22.4\n23.7\n1.3\n15.39\n16.28\n0.89\n\n\nE\n20.7\n18.6\n−2.0\n14.16\n12.77\n−1.39\n\n\nF\n23.5\n21.3\n−2.3\n16.14\n14.58\n−1.56\n\n\nTotal\n145.84\n145.84\n0.00\n100.00\n100.00\n0.00\n\n\n\n1 Climatological Reference Period 1961-1990\n\n\n2 Recent Climate Period 2011-2024",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Analyze Classification Changes</span>"
    ]
  },
  {
    "objectID": "05_analyze_changes.html#map",
    "href": "05_analyze_changes.html#map",
    "title": "6  Analyze Classification Changes",
    "section": "6.11 Map",
    "text": "6.11 Map\n\n\nCode\nplot_data &lt;- kcc_zones_sf  |&gt;\n  select(cz1) |&gt;\n  rename(Group = cz1)\np1 &lt;- fn_create_map(plot_data, \"Köppen\", kcc_palette, kcc_labels)\np1\n\n\n\n\n\n\n\n\n\nCode\nplot_data &lt;- tcc_zones_sf |&gt;\n  select(cz1) |&gt;\n  rename(Group = cz1)\np2 &lt;- fn_create_map(plot_data, \"Trewartha\", tcc_palette, tcc_labels)\np2",
    "crumbs": [
      "<span class='chapter-number'>6</span>  <span class='chapter-title'>Analyze Classification Changes</span>"
    ]
  },
  {
    "objectID": "03_derive_determinants.html#import",
    "href": "03_derive_determinants.html#import",
    "title": "4  Derive Classification Determinants",
    "section": "4.4 Import",
    "text": "4.4 Import\n\n\nCode\npth &lt;- paste(dir_rd, \"crp_aggregated_t.parquet\", sep = \"\")\ncrp_t_df &lt;- read_parquet(pth) \npth &lt;- paste(dir_rd, \"crp_aggregated_p.parquet\", sep = \"\")\ncrp_p_df &lt;- read_parquet(pth) \n\npth &lt;- paste(dir_rd, \"rcp_aggregated_t.parquet\", sep = \"\")\nrcp_t_df &lt;- read_parquet(pth) \npth &lt;- paste(dir_rd, \"rcp_aggregated_p.parquet\", sep = \"\")\nrcp_p_df &lt;- read_parquet(pth)",
    "crumbs": [
      "<span class='chapter-number'>4</span>  <span class='chapter-title'>Derive Classification Determinants</span>"
    ]
  }
]