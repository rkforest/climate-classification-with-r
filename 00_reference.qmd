---
title: "Reference for Global Climate Classification Changes"
format: html
---

## To D:

book format
 + fix right margin
 + update the overview steps

01_download_data
 + 
02_aggregate_data
 + 
03_derive_determinants
 + 
04_classify_types
 + 
05_analyze_changes
 + 




## ***Packages***

```{r}
#| label: pkg
suppressPackageStartupMessages({
  library(tidyverse)
  library(rnaturalearth)
})
```


## ***Directories***

```{r paths}
dir_rf <- "data/00_reference/"
```

## ***Trewartha Climate Zones***

### Group

```{r}
ktc_group <- c(
  "A", "B", "C", "D", "E", "F"
)

ktc_group_labels <- c(
  A = "Tropical ",
  B = "Dry", 
  C = "Subtropical",
  D = "Temperate",
  E = "Boreal",
  F = "Polar"
)

ktc_group_hex <- c(
  "A" = "#c23734",  
  "B" = "#f09758", 
  "C" = "#33a02c",  #  #1a9850, #33a02c, #74c29b
  "D" = "#02add7", 
  "E" = "#1552a2",  
  "F" = "#9674c1"   
)

# ktc_group_hex <- c(

#   "A" = "#c23734",  #  #b2182b, #d35362, #dd7276
#   "B" = "#f09758",  #  #eb8034, #f09758, #f9c5a0
#   "C" = "#13724f",  #  #1a9850, #56b482, #74c29b
#   "D" = "#02add7",  #  #2255a4, #5c89c0, #79a3ce
#   "E" = "#1552a2",  #  #017783, #33929b, #99c8cb
#   "F" = "#9674c1"   #  #5e3c99, #7a60ad, #9674c1
# )

#   "D" = "#2255a4", "E" = "#017783",  
#   "Do" = "#02add7", "Dc" = "#0f74bb", "E"  = "#1552a2",

ktc_group_palette  <- data.frame(
  grp = ktc_group, 
  hex = ktc_group_hex,
  lbl = ktc_group_labels
)

fil <- "ktc_group_palette.csv"
pth <- paste0(dir_rf,fil)
write_csv(ktc_group_palette, pth)

```

### Type

```{r}
ktc_type <- c(
  "Ar", "Aw",
  "BW", "BS",
  "Cs", "Cw", "Cf",
  "Do", "Dc",
  "E",
  "Ft", "Fi"
)

ktc_type_labels <- c(
  Ar="Tropical Rainforest",        Aw="Tropical Savanna (dry season)",
  BW="Desert (Arid)",              BS="Steppe (Semiarid)",
  Cs="Mediterranean (dry summer)", Cw="Subtropical (dry winter)",
  Cf="Subtropical (no dry season)",
  Do="Temperate (Oceanic)",        Dc="Temperate (Continental)",
  E="Boreal (Subarctic)",
  Ft="Tundra",                     Fi="Ice Cap"
)

ktc_type_hex <- c(
  "Ar" = "#85080c", "Aw" = "#cb1e0a",
  "BW" = "#fede49", "BS" = "#f09036",
  "Cs" = "#38d98f", "Cw" = "#1f9d6d", "Cf" = "#13724f", 
  "Do" = "#02add7", "Dc" = "#0f74bb", "E"  = "#1552a2",
  "Ft" = "#9c84c7", "Fi" = "#60468d"
)

#   "Dc" = "#1552a2",
#   "E"  = "#b2559c", "E"  = "#017783",

ktc_type_palette  <- data.frame(
  typ = ktc_type,
  hex = ktc_type_hex,
  lbl = ktc_type_labels
)

fil <- "ktc_type_palette.csv"
pth <- paste0(dir_rf,fil)
write_csv(ktc_type_palette, pth)

```

## Download natural earth coastline

```{r}
dir <- dir_rf 
fil <- "global-coastline.gpkg"
pth <- paste(dir, fil, sep = "")
if (!file.exists(pth))  {
  ne_coastline_sf <-
    ne_download(
      scale = 10,
      type = "coastline",
      category = "physical",
      returnclass = "sf"
    )
  st_write(ne_coastline_sf, pth, delete_dsn = TRUE, quiet = TRUE)
}
```

### Transform global coastline

```{r transform-ne-coastline}

fn_transform_ne_coastline <- function(dir_download) {
  # Create a single coastline multiline, making sure geometries are valid
  # (eliminates extra horizontal line on map)

  dir <- dir_rf 
  fil <- "global-coastline.gpkg"
  pth <- paste(dir, fil, sep = "")
  coastline_sf <- st_read(pth, quiet = TRUE)

  coastline_sf <- coastline_sf |>
    select(geom) |>
    mutate(id = "world") |>
    group_by(id) |>
    st_make_valid() |>
    summarise()
  return(coastline_sf)
}

dir <- dir_rf 
fil <- "global-coastline.gpkg"
pth <- paste(dir, fil, sep = "")

if (!file.exists(pth))  {
  coastline_sf <- fn_transform_ne_coastline(dir_download)
  st_write(coastline_sf, pth, delete_dsn = TRUE, quiet = TRUE)
}

```

